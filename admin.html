<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Job Experiences & Projects</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'blue': '#106EBE',
                        'mint': '#0FFCBE',
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #106EBE, #0FFCBE);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #106EBE, #0FFCBE);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 110, 190, 0.2);
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .file-upload-area:hover {
            border-color: #106EBE;
            background-color: #f8fafc;
        }
        .file-upload-area.dragover {
            border-color: #106EBE;
            background-color: #eff6ff;
        }
        .image-preview {
            max-width: 200px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .file-upload-area:hover {
            border-color: #106EBE;
            background-color: #f8fafc;
        }
        .file-upload-area.dragover {
            border-color: #106EBE;
            background-color: #eff6ff;
        }
        .image-preview {
            max-width: 200px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <h1 class="text-3xl font-bold gradient-text">Admin Panel</h1>
                    <span class="ml-4 text-gray-500">Job Experiences & Projects Management</span>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-blue-600 hover:text-blue-800 transition-colors">
                        ‚Üê Back to Website
                    </a>
                    <button onclick="resetIntro()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:opacity-90 transition-opacity">
                        üé¨ Reset Intro
                    </button>
                    <button onclick="refreshData()" class="gradient-bg text-white px-4 py-2 rounded-lg hover:opacity-90 transition-opacity">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Tabs -->
        <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg mb-8">
            <button 
                onclick="showTab('experiences')" 
                id="experiencesTab"
                class="flex-1 py-2 px-4 rounded-md font-medium transition-all duration-200 bg-white text-gray-900 shadow-sm"
            >
                üíº Job Experiences
            </button>
            <button 
                onclick="showTab('projects')" 
                id="projectsTab"
                class="flex-1 py-2 px-4 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-gray-900"
            >
                üöÄ Projects
            </button>
        </div>

        <!-- Experiences Tab -->
        <div id="experiencesContent">
            <!-- Add New Experience -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8 card-hover">
                <h2 class="text-2xl font-semibold text-gray-900 mb-6">‚ûï Add New Experience</h2>
                <form id="addExperienceForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Period *</label>
                        <input type="text" id="period" name="period" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="e.g., 2023 - Present">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Company *</label>
                        <input type="text" id="company" name="company" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="e.g., Tech Solutions Inc.">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Job Title *</label>
                        <input type="text" id="jobTitle" name="jobTitle" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="e.g., Full Stack Developer">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                        <select id="status" name="status" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select Status</option>
                            <option value="current">Current</option>
                            <option value="past">Past</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Link</label>
                        <input type="url" id="link" name="link" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="https://company.com">
                    </div>
                    <div class="md:col-span-2 lg:col-span-5">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="description" name="description" rows="3" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                  placeholder="Describe your role and achievements..."></textarea>
                    </div>
                    <div class="md:col-span-2 lg:col-span-5">
                        <button type="submit" class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity font-medium">
                            ‚ûï Add Experience
                        </button>
                    </div>
                </form>
            </div>

            <!-- Experiences List -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 card-hover">
                <h2 class="text-2xl font-semibold text-gray-900 mb-6">üìã Current Experiences</h2>
                <div id="experiencesList" class="space-y-4">
                    <!-- Experiences will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Projects Tab -->
        <div id="projectsContent" class="hidden">
            <!-- Add New Project -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8 card-hover">
                <h2 class="text-2xl font-semibold text-gray-900 mb-6">‚ûï Add New Project</h2>
                <form id="addProjectForm" class="space-y-4" enctype="multipart/form-data">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Project Title *</label>
                            <input type="text" id="projectTitle" name="projectTitle" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="e.g., AI Nutrition Assistant">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Project Image *</label>
                            <div class="file-upload-area rounded-lg p-4 text-center cursor-pointer" 
                                 onclick="document.getElementById('projectImageFile').click()"
                                 ondrop="handleDrop(event)"
                                 ondragover="handleDragOver(event)"
                                 ondragleave="handleDragLeave(event)">
                                <input type="file" id="projectImageFile" name="image" accept="image/*" class="hidden" onchange="handleImageSelect(event)">
                                <div id="imageUploadText">
                                    <div class="text-gray-400 mb-2">
                                        <svg class="mx-auto h-12 w-12" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                    <p class="text-sm text-gray-600">
                                        <span class="font-medium text-blue-600 hover:text-blue-500">Click to upload</span> or drag and drop
                                    </p>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, GIF up to 5MB</p>
                                </div>
                                <div id="imagePreview" class="hidden">
                                    <img id="previewImg" class="image-preview mx-auto mb-2">
                                    <p class="text-sm text-gray-600">Image selected</p>
                                    <button type="button" onclick="removeImage()" class="text-red-600 hover:text-red-800 text-sm mt-1">
                                        Remove image
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
                        <textarea id="projectDescription" name="projectDescription" rows="4" required
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                  placeholder="Describe your project, features, and achievements..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Skills Used * (comma-separated)</label>
                        <input type="text" id="projectSkills" name="projectSkills" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="e.g., React, TypeScript, Node.js, MongoDB">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">GitHub Link (Optional)</label>
                            <input type="url" id="projectGithub" name="projectGithub" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="https://github.com/username/repo">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Live Demo Link (Optional)</label>
                            <input type="url" id="projectLive" name="projectLive" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="https://demo.example.com">
                        </div>
                    </div>
                    <div>
                        <button type="submit" class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity font-medium">
                            ‚ûï Add Project
                        </button>
                    </div>
                </form>
            </div>

            <!-- Projects List -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 card-hover">
                <h2 class="text-2xl font-semibold text-gray-900 mb-6">üìã Current Projects</h2>
                <div id="projectsList" class="space-y-4">
                    <!-- Projects will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Edit Experience Modal -->
    <div id="editExperienceModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-semibold text-gray-900">‚úèÔ∏è Edit Experience</h3>
                    <button onclick="closeEditExperienceModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                        √ó
                    </button>
                </div>
                <form id="editExperienceForm" class="space-y-4">
                    <input type="hidden" id="editExpId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Period *</label>
                            <input type="text" id="editPeriod" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Company *</label>
                            <input type="text" id="editCompany" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Job Title *</label>
                            <input type="text" id="editJobTitle" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                            <select id="editStatus" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="current">Current</option>
                                <option value="past">Past</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Link</label>
                            <input type="url" id="editLink" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="editDescription" rows="4" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeEditExperienceModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 transition-opacity">
                            üíæ Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Project Modal -->
    <div id="editProjectModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-semibold text-gray-900">‚úèÔ∏è Edit Project</h3>
                    <button onclick="closeEditProjectModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                        √ó
                    </button>
                </div>
                <form id="editProjectForm" class="space-y-4" enctype="multipart/form-data">
                    <input type="hidden" id="editProjId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Project Title *</label>
                            <input type="text" id="editProjectTitle" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Project Image</label>
                            <div class="file-upload-area rounded-lg p-4 text-center cursor-pointer" 
                                 onclick="document.getElementById('editProjectImageFile').click()"
                                 ondrop="handleEditDrop(event)"
                                 ondragover="handleDragOver(event)"
                                 ondragleave="handleDragLeave(event)">
                                <input type="file" id="editProjectImageFile" name="image" accept="image/*" class="hidden" onchange="handleEditImageSelect(event)">
                                <div id="editImageUploadText">
                                    <div class="text-gray-400 mb-2">
                                        <svg class="mx-auto h-12 w-12" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                    <p class="text-sm text-gray-600">
                                        <span class="font-medium text-blue-600 hover:text-blue-500">Click to upload</span> or drag and drop
                                    </p>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, GIF up to 5MB</p>
                                </div>
                                <div id="editImagePreview" class="hidden">
                                    <img id="editPreviewImg" class="image-preview mx-auto mb-2">
                                    <p class="text-sm text-gray-600">New image selected</p>
                                    <button type="button" onclick="removeEditImage()" class="text-red-600 hover:text-red-800 text-sm mt-1">
                                        Remove new image
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
                        <textarea id="editProjectDescription" rows="4" required
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Skills Used * (comma-separated)</label>
                        <input type="text" id="editProjectSkills" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">GitHub Link (Optional)</label>
                            <input type="url" id="editProjectGithub" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Live Demo Link (Optional)</label>
                            <input type="url" id="editProjectLive" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeEditProjectModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 transition-opacity">
                            üíæ Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Success/Error Toast -->
    <div id="toast" class="fixed top-4 right-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg border border-gray-200 p-4 max-w-sm">
            <div class="flex items-center">
                <div id="toastIcon" class="mr-3 text-xl"></div>
                <div>
                    <div id="toastTitle" class="font-medium text-gray-900"></div>
                    <div id="toastMessage" class="text-sm text-gray-600"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let experiences = [];
        let projects = [];
        let currentTab = 'experiences';
        let selectedImageFile = null;
        let editSelectedImageFile = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadExperiences();
            loadProjects();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('addExperienceForm').addEventListener('submit', handleAddExperience);
            document.getElementById('editExperienceForm').addEventListener('submit', handleEditExperience);
            document.getElementById('addProjectForm').addEventListener('submit', handleAddProject);
            document.getElementById('editProjectForm').addEventListener('submit', handleEditProject);
        }

        // Tab management
        function showTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.getElementById('experiencesTab').className = tabName === 'experiences' 
                ? 'flex-1 py-2 px-4 rounded-md font-medium transition-all duration-200 bg-white text-gray-900 shadow-sm'
                : 'flex-1 py-2 px-4 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-gray-900';
            
            document.getElementById('projectsTab').className = tabName === 'projects' 
                ? 'flex-1 py-2 px-4 rounded-md font-medium transition-all duration-200 bg-white text-gray-900 shadow-sm'
                : 'flex-1 py-2 px-4 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-gray-900';
            
            // Show/hide content
            document.getElementById('experiencesContent').classList.toggle('hidden', tabName !== 'experiences');
            document.getElementById('projectsContent').classList.toggle('hidden', tabName !== 'projects');
        }

        // Load experiences from API
        async function loadExperiences() {
            try {
                const response = await fetch('/api/experiences');
                experiences = await response.json();
                renderExperiences();
            } catch (error) {
                showToast('Error', 'Failed to load experiences', 'error');
            }
        }

        // Load projects from API
        async function loadProjects() {
            try {
                const response = await fetch('/api/projects');
                projects = await response.json();
                renderProjects();
            } catch (error) {
                showToast('Error', 'Failed to load projects', 'error');
            }
        }

        // Render experiences list
        function renderExperiences() {
            const container = document.getElementById('experiencesList');
            
            if (experiences.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No experiences found. Add your first one above!</p>';
                return;
            }

            container.innerHTML = experiences.map(exp => `
                <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">${exp.period}</span>
                                <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">${exp.company}</span>
                                <span class="text-sm ${exp.status === 'current' ? 'text-green-600 bg-green-100' : 'text-orange-600 bg-orange-100'} px-2 py-1 rounded font-medium">
                                    ${exp.status === 'current' ? 'üü¢ Current' : 'üü† Past'}
                                </span>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-1">${exp.job_title}</h3>
                            ${exp.description ? `<p class="text-gray-600 text-sm mb-2">${exp.description}</p>` : ''}
                            ${exp.link ? `<a href="${exp.link}" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm">üîó ${exp.link}</a>` : ''}
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="editExperience(${exp.id})" 
                                    class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition-colors">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="deleteExperience(${exp.id})" 
                                    class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition-colors">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    <div class="text-xs text-gray-400">
                        Created: ${new Date(exp.created_at).toLocaleDateString()}
                        ${exp.updated_at !== exp.created_at ? ` | Updated: ${new Date(exp.updated_at).toLocaleDateString()}` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Render projects list
        function renderProjects() {
            const container = document.getElementById('projectsList');
            
            if (projects.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No projects found. Add your first one above!</p>';
                return;
            }

            container.innerHTML = projects.map(proj => `
                <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <img src="${proj.image}" alt="${proj.title}" class="w-12 h-12 object-cover rounded-lg">
                                <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">${proj.skills.length} skills</span>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-1">${proj.title}</h3>
                            <p class="text-gray-600 text-sm mb-2">${proj.description}</p>
                            <div class="flex flex-wrap gap-1 mb-2">
                                ${proj.skills.map(skill => `<span class="text-xs bg-mint/10 text-mint px-2 py-1 rounded">${skill}</span>`).join('')}
                            </div>
                            ${proj.github || proj.live ? `<div class="text-sm text-gray-500">üîó ${proj.github ? 'GitHub' : ''}${proj.github && proj.live ? ' ‚Ä¢ ' : ''}${proj.live ? 'Live Demo' : ''}</div>` : ''}
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="editProject(${proj.id})" 
                                    class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition-colors">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="deleteProject(${proj.id})" 
                                    class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition-colors">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    <div class="text-xs text-gray-400">
                        Created: ${new Date(proj.created_at).toLocaleDateString()}
                        ${proj.updated_at !== proj.created_at ? ` | Updated: ${new Date(proj.updated_at).toLocaleDateString()}` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Handle add experience
        async function handleAddExperience(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                period: formData.get('period'),
                company: formData.get('company'),
                job_title: formData.get('jobTitle'),
                status: formData.get('status'),
                description: formData.get('description'),
                link: formData.get('link')
            };

            try {
                const response = await fetch('/api/experiences', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showToast('Success', 'Experience added successfully!', 'success');
                    e.target.reset();
                    loadExperiences();
                } else {
                    const error = await response.json();
                    showToast('Error', error.error || 'Failed to add experience', 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to add experience', 'error');
            }
        }

        // Handle add project
        async function handleAddProject(e) {
            e.preventDefault();
            
            if (!selectedImageFile) {
                showToast('Error', 'Please select a project image', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('title', document.getElementById('projectTitle').value);
            formData.append('description', document.getElementById('projectDescription').value);
            formData.append('image', selectedImageFile);
            formData.append('skills', document.getElementById('projectSkills').value);
            formData.append('github', document.getElementById('projectGithub').value);
            formData.append('live', document.getElementById('projectLive').value);

            try {
                const response = await fetch('/api/projects', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    showToast('Success', 'Project added successfully!', 'success');
                    e.target.reset();
                    selectedImageFile = null;
                    resetImageUpload();
                    loadProjects();
                } else {
                    const error = await response.json();
                    showToast('Error', error.error || 'Failed to add project', 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to add project', 'error');
            }
        }

        // Handle edit experience
        async function handleEditExperience(e) {
            e.preventDefault();
            
            const id = document.getElementById('editExpId').value;
            const data = {
                period: document.getElementById('editPeriod').value,
                company: document.getElementById('editCompany').value,
                job_title: document.getElementById('editJobTitle').value,
                status: document.getElementById('editStatus').value,
                description: document.getElementById('editDescription').value,
                link: document.getElementById('editLink').value
            };

            try {
                const response = await fetch(`/api/experiences/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showToast('Success', 'Experience updated successfully!', 'success');
                    closeEditExperienceModal();
                    loadExperiences();
                } else {
                    const error = await response.json();
                    showToast('Error', error.error || 'Failed to update experience', 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to update experience', 'error');
            }
        }

        // Handle edit project
        async function handleEditProject(e) {
            e.preventDefault();
            
            const id = document.getElementById('editProjId').value;
            const formData = new FormData();
            formData.append('title', document.getElementById('editProjectTitle').value);
            formData.append('description', document.getElementById('editProjectDescription').value);
            formData.append('skills', document.getElementById('editProjectSkills').value);
            formData.append('github', document.getElementById('editProjectGithub').value);
            formData.append('live', document.getElementById('editProjectLive').value);
            
            // Only append image if a new one is selected
            if (editSelectedImageFile) {
                formData.append('image', editSelectedImageFile);
            }

            try {
                const response = await fetch(`/api/projects/${id}`, {
                    method: 'PUT',
                    body: formData
                });

                if (response.ok) {
                    showToast('Success', 'Project updated successfully!', 'success');
                    closeEditProjectModal();
                    editSelectedImageFile = null;
                    resetEditImageUpload();
                    loadProjects();
                } else {
                    const error = await response.json();
                    showToast('Error', error.error || 'Failed to update project', 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to update project', 'error');
            }
        }

        // Edit experience
        function editExperience(id) {
            const experience = experiences.find(exp => exp.id === id);
            if (!experience) return;

            document.getElementById('editExpId').value = experience.id;
            document.getElementById('editPeriod').value = experience.period;
            document.getElementById('editCompany').value = experience.company;
            document.getElementById('editJobTitle').value = experience.job_title;
            document.getElementById('editStatus').value = experience.status || 'current';
            document.getElementById('editDescription').value = experience.description || '';
            document.getElementById('editLink').value = experience.link || '';

            document.getElementById('editExperienceModal').classList.remove('hidden');
        }

        // Edit project
        function editProject(id) {
            const project = projects.find(proj => proj.id === id);
            if (!project) return;

            document.getElementById('editProjId').value = project.id;
            document.getElementById('editProjectTitle').value = project.title;
            document.getElementById('editProjectDescription').value = project.description;
            document.getElementById('editProjectSkills').value = project.skills.join(', ');
            document.getElementById('editProjectGithub').value = project.github || '';
            document.getElementById('editProjectLive').value = project.live || '';

            // Reset edit image upload
            editSelectedImageFile = null;
            resetEditImageUpload();

            document.getElementById('editProjectModal').classList.remove('hidden');
        }

        // Close modals
        function closeEditExperienceModal() {
            document.getElementById('editExperienceModal').classList.add('hidden');
        }

        function closeEditProjectModal() {
            document.getElementById('editProjectModal').classList.add('hidden');
        }

        // Delete experience
        async function deleteExperience(id) {
            if (!confirm('Are you sure you want to delete this experience?')) return;

            try {
                const response = await fetch(`/api/experiences/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showToast('Success', 'Experience deleted successfully!', 'success');
                    loadExperiences();
                } else {
                    const error = await response.json();
                    showToast('Error', error.error || 'Failed to delete experience', 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to delete experience', 'error');
            }
        }

        // Delete project
        async function deleteProject(id) {
            if (!confirm('Are you sure you want to delete this project?')) return;

            try {
                const response = await fetch(`/api/projects/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showToast('Success', 'Project deleted successfully!', 'success');
                    loadProjects();
                } else {
                    const error = await response.json();
                    showToast('Error', error.error || 'Failed to delete project', 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to delete project', 'error');
            }
        }

        // Refresh data
        function refreshData() {
            if (currentTab === 'experiences') {
                loadExperiences();
            } else {
                loadProjects();
            }
            showToast('Info', 'Data refreshed!', 'info');
        }

        // Reset intro animation
        function resetIntro() {
            localStorage.removeItem('introSeen');
            showToast('Success', 'Intro animation reset! Refresh the main website to see it again.', 'success');
        }

        // Image upload handlers
        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (file) {
                selectedImageFile = file;
                showImagePreview(file, 'previewImg', 'imageUploadText', 'imagePreview');
            }
        }

        function handleEditImageSelect(event) {
            const file = event.target.files[0];
            if (file) {
                editSelectedImageFile = file;
                showImagePreview(file, 'editPreviewImg', 'editImageUploadText', 'editImagePreview');
            }
        }

        function showImagePreview(file, imgId, textId, previewId) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById(imgId).src = e.target.result;
                document.getElementById(textId).classList.add('hidden');
                document.getElementById(previewId).classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        function removeImage() {
            selectedImageFile = null;
            document.getElementById('projectImageFile').value = '';
            resetImageUpload();
        }

        function removeEditImage() {
            editSelectedImageFile = null;
            document.getElementById('editProjectImageFile').value = '';
            resetEditImageUpload();
        }

        function resetImageUpload() {
            document.getElementById('imageUploadText').classList.remove('hidden');
            document.getElementById('imagePreview').classList.add('hidden');
        }

        function resetEditImageUpload() {
            document.getElementById('editImageUploadText').classList.remove('hidden');
            document.getElementById('editImagePreview').classList.add('hidden');
        }

        // Drag and drop handlers
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    selectedImageFile = file;
                    document.getElementById('projectImageFile').files = files;
                    showImagePreview(file, 'previewImg', 'imageUploadText', 'imagePreview');
                } else {
                    showToast('Error', 'Please select an image file', 'error');
                }
            }
        }

        function handleEditDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    editSelectedImageFile = file;
                    document.getElementById('editProjectImageFile').files = files;
                    showImagePreview(file, 'editPreviewImg', 'editImageUploadText', 'editImagePreview');
                } else {
                    showToast('Error', 'Please select an image file', 'error');
                }
            }
        }

        // Show toast notification
        function showToast(title, message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');

            // Set icon and colors based on type
            switch (type) {
                case 'success':
                    toastIcon.textContent = '‚úÖ';
                    toastIcon.className = 'mr-3 text-xl text-green-600';
                    break;
                case 'error':
                    toastIcon.textContent = '‚ùå';
                    toastIcon.className = 'mr-3 text-xl text-red-600';
                    break;
                case 'info':
                    toastIcon.textContent = '‚ÑπÔ∏è';
                    toastIcon.className = 'mr-3 text-xl text-blue-600';
                    break;
            }

            toastTitle.textContent = title;
            toastMessage.textContent = message;

            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html> 
